<script>
    async function generateDigest() {
        const topic = document.getElementById('digest-topic').value || 'AI Trends';
        const container = document.getElementById('digest-result');
        const button = document.getElementById('generate-btn');

        container.innerHTML = '<p class="text-neutral-500 animate-pulse">Generating your digest with AI...</p>';
        button.disabled = true;
        button.classList.add('opacity-50', 'cursor-not-allowed');

        try {
            const response = await fetch(`http://localhost:8000/api/generate/digest?topic=${encodeURIComponent(topic)}`);
            const data = await response.json();

            // Simple markdown parsing (bolding)
            let formattedDigest = data.digest.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formattedDigest = formattedDigest.replace(/\n/g, '<br>');

            container.innerHTML = `
            <div class="bg-white dark:bg-neutral-800 p-6 rounded-lg shadow-md border border-neutral-200 dark:border-neutral-700">
                <h3 class="text-xl font-bold mb-2 text-primary-600">Daily Digest: ${data.topic}</h3>
                <div class="prose dark:prose-invert max-w-none">
                    ${formattedDigest}
                </div>
                <div class="mt-4 text-xs text-neutral-400">Generated by AI Agent</div>
            </div>
        `;
        } catch (error) {
            container.innerHTML = `<p class="text-red-500">Error generating digest. Is the backend running?</p>`;
            console.error(error);
        } finally {
            button.disabled = false;
            button.classList.remove('opacity-50', 'cursor-not-allowed');
        }
    }
</script>