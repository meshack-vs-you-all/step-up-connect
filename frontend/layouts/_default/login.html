{{ define "main" }}
<div class="container mx-auto px-4 py-16 max-w-md">
    <div class="bg-white dark:bg-neutral-800 rounded-xl shadow-lg p-8">
        <h1 class="text-3xl font-bold mb-6 text-center">Welcome Back</h1>

        <form id="login-form" class="space-y-4">
            <div>
                <label class="block text-sm font-bold mb-2">Email</label>
                <input type="email" id="email"
                    class="w-full px-4 py-2 border rounded-lg dark:bg-neutral-700 dark:border-neutral-600" required
                    placeholder="admin@stepup.com">
            </div>
            <div>
                <label class="block text-sm font-bold mb-2">Password</label>
                <input type="password" id="password"
                    class="w-full px-4 py-2 border rounded-lg dark:bg-neutral-700 dark:border-neutral-600" required
                    placeholder="admin123">
            </div>
            <div id="login-error" class="text-red-500 text-sm hidden"></div>
            <button type="submit"
                class="w-full py-2 bg-primary-600 text-white font-bold rounded-lg hover:bg-primary-500 transition">
                Sign In
            </button>
        </form>

        <p class="mt-4 text-center text-sm text-neutral-500">
            Use <b>admin@stepup.com / admin123</b> for demo.
        </p>
    </div>
</div>

<script>
    const apiBaseURL = "{{ site.Params.apiBaseURL }}";

    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('login-error');

        try {
            // Updated endpoint to match OAuth2 form data structure if needed, 
            // but our backend auth currently accepts form data.
            // Let's use x-www-form-urlencoded as per OAuth2PasswordRequestForm
            const formData = new URLSearchParams();
            formData.append('username', email); // OAuth2 expects 'username'
            formData.append('password', password);

            const response = await fetch(`${apiBaseURL}/api/auth/token`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: formData
            });

            if (response.ok) {
                const data = await response.json();
                localStorage.setItem('token', data.access_token);
                window.location.href = '/profile';
            } else {
                errorDiv.textContent = "Invalid credentials. Please try again.";
                errorDiv.classList.remove('hidden');
            }
        } catch (error) {
            console.error('Login error:', error);
            errorDiv.textContent = "An error occurred. Is the backend running?";
            errorDiv.classList.remove('hidden');
        }
    });
</script>
{{ end }}